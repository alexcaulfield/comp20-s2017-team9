<!DOCTYPE html>

<!-- Client ID: 6098f27b8bbe48f4a1f7c74e68bc2884 -->
<!-- Client Secret: f836f513f2f64d2bb6f4f3def24d30de -->


<html>
<head>
	<title>Game page</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
	<link rel ="stylesheet" href="bootstrap.css">
	<link rel="stylesheet" type="text/css" href="main.css">

</head>
<body>
    <nav class="navbar navbar-default" role="navigation">
	  <div class="container">
	    <!-- Brand and toggle get grouped for better mobile display -->
	    <div class="navbar-header">
	      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-brand-centered">
	        <span class="sr-only">Toggle navigation</span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	        <span class="icon-bar"></span>
	      </button>
	      <div class="navbar-brand navbar-brand-centered"><a href="index.html">Pop Quiz</a></div>
	    </div>

	    <!-- Collect the nav links, forms, and other content for toggling -->
	    <div class="collapse navbar-collapse" id="navbar-brand-centered">
	      <ul class="nav navbar-nav navbar-left">
	        <li><a href="howto.html">How to Play</a></li>
	        <li><a href="about.html">About</a></li>
	      </ul>
	      <ul class="nav navbar-nav navbar-right">
	        <li class="active"><a href="#">Game</a></li>
	        <li><a href="scoreboard.html">Scoreboard</a></li>		        
	      </ul>
	    </div><!-- /.navbar-collapse -->
	  </div><!-- /.container-fluid -->
	</nav>
	
	<button class="btn btn-default" type="button" onclick="getSong(1)"><div id="songname1">Song 1</div>
	<div id="song-preview1"></div></button><br><br><br>

	<button class="btn btn-default" type="button" onclick="getSong(2)"><div id="songname2">Song 2</div>
	<div id="song-preview2"></div></button><br><br><br>

	<button class="btn btn-default" type="button" onclick="getSong(3)"><div id="songname3">Song 3</div>
	<div id="song-preview3"></div></button><br><br><br>

	<button class="btn btn-default" type="button" onclick="getSong(4)"><div id="songname4">Song 4</div>
	<div id="song-preview4"></div></button>

	<script type="text/javascript">

	var previewUrl;
	var audioObject = null;
	var meme_songs = ["6snnRz6kK978tSyUdejEyg", "4z6uwQKPhhIOOFCeiftv3J", "3xgK660fsZH7ZDcOMfIdfB", "0gfmYDvAZxOl6jXk1N9Fwy",   
						 "4tCtwWceOPWzenK2HAIJSb", "0d5f6gzzW1Pgx9uJsLrSDP", "6umBH7xHLEU9RVhH4mpXQ3", "3cfOd4CMv2snFaKAnMdnvK"];
	var song1 = "";
	var song2 = "";
	var song3 = "";
	var song4 = "";

/*apparently to use this access token request needs to be made server-side*/
		/*$.ajax({
			url: "https://accounts.spotify.com/api/token",
			method: "POST",
			data: {grant_type: "client_credentials"},

			headers: {"Authorization": "Basics", "6098f27b8bbe48f4a1f7c74e68bc2884": "f836f513f2f64d2bb6f4f3def24d30de", "Access-Control-Allow-Origin": "*"},
			success: function (response){
				console.log(response);
			},
			error: function (response){
				console.log("ERROR");
			}
		})*/


		function getSong(num) {

			var song_url = "https://api.spotify.com/v1/tracks/";

			while ((song_url == "https://api.spotify.com/v1/tracks/") || (song_url == song1) || (song_url == song2) || 
					(song_url == song3) || (song_url == song4)){

				song_url += meme_songs[(Math.floor((Math.random() * 100) + 1))%(meme_songs.length)];
			}

			var pre_track = 'song-preview';
				pre_track += num;

			var previewTrack = document.getElementById(pre_track);

		  $.ajax({
			url: song_url,
			data: {
			  country: 'US'
			},
			success: function (response) {
				console.log(response.preview_url);
				previewUrl = response.preview_url;
				audioObject = new Audio(); 
				previewTrack.innerHTML = '<audio id="audio-player" controls="controls" src="' +response.preview_url  + '" type="audio/mpeg">';
				if (num == 1){
					songname1.innerHTML = response.name;
					song1 = song_url;
				}
				else if (num == 2){
					songname2.innerHTML = response.name;
					song2 = song_url;
				}
				else if (num ==3){
					songname3.innerHTML = response.name;
					song3 = song_url;
				}
				else if (num ==4){
					songname4.innerHTML = response.name;
					song4 = song_url;
				}
			},
			error: function (response) {
			    console.log("ERROR: Track not found");
			    console.log(song_url);
			}
		})
		};
	</script>

</body>
</html>			